// YOUR TURN: add your Mapbox access token 
mapboxgl.accessToken = 'pk.eyJ1IjoibGVlanVuZGRhcmkiLCJhIjoiY2thYXdxYjh6MHI5ZzJxa2hsejRyMTFnMyJ9._5F3Mqj7QmtTwRjKTlZhbw';
var map = new mapboxgl.Map({
  container: 'map', // container id
  style: "mapbox://styles/leejunddari/ckarocjce0nzk1ileaetrokwo", // YOUR TURN: choose a style: https://docs.mapbox.com/api/maps/#styles
  center: [126.993, 37.575], // starting position [lng, lat]
  zoom: 9 // starting zoom
});


$(document).ready(function () {
    $.ajax({
      type: "GET",
      // YOUR TURN: Replace 'url' value to CSV export link 
      url: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRxjTAVaPmrcWqT-h7Qb-8gbLmEM4i8YJI_5XN_OfdQ8R5fZ6ljbsA-MU-EI84fVHtO9fCp6ZJ5L7KC/pubhtml?gid=0&single=true', 
      dataType: "text",
      success: function (csvData) { makeGeoJSON(csvData); }
    });
  });

  //Add the the layer to the map 
  map.addLayer({
    'id': 'csvData',
    'type': 'circle',
    'source': {
      'type': 'geojson',
      'data': data
    },
    'paint': {
      'circle-radius': 5,
      'circle-color': "purple"
    }
  });


  // When a click event occurs on a feature in the csvData layer, open a popup at the
            // location of the feature, with description HTML from its properties.
            map.on('click', 'csvData', function (e) {
              var coordinates = e.features[0].geometry.coordinates.slice();

              //set popup text 
              //You can adjust the values of the popup to match the headers of your CSV. 
              // For example: e.features[0].properties.Name is retrieving information from the field Name in the original CSV. 
              var description = `<h3>` + e.features[0].properties.Name + `</h3>` + `<h4>` + `<b>` + `Gu: ` + `</b>` + e.features[0].properties.Gu + `</h4>` +`<h4>` + `<b>` + `RoadSN: ` + `</b>` + e.features[0].properties.RoadSN + `</h4>`+`<h4>` + `<b>` + `TreeId: ` + `</b>` + e.features[0].properties.TreeId + `</h4>`+`<h4>` + `<b>` + `Species: ` + `</b>` + e.features[0].properties.Species + `</h4>`+`<h4>` + `<b>` + `DBH: ` + `</b>` + e.features[0].properties.DBH + `</h4>`+`<h4>` + `<b>` + `CondLvs: ` + `</b>` + e.features[0].properties.CondLvs + `</h4>`+`<h4>` + `<b>` + `CondWood: ` + `</b>` + e.features[0].properties.CondWood + `</h4>`;

              // Ensure that if the map is zoomed out such that multiple
              // copies of the feature are visible, the popup appears
              // over the copy being pointed to.
              while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
              }

              //add Popup to map

              new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML(description)
                .addTo(map);
            });

            // Change the cursor to a pointer when the mouse is over the places layer.
            map.on('mouseenter', 'csvData', function () {
              map.getCanvas().style.cursor = 'pointer';
            });

            // Change it back to a pointer when it leaves.
            map.on('mouseleave', 'places', function () {
              map.getCanvas().style.cursor = '';
            });

            var bbox = turf.bbox(data);
            map.fitBounds(bbox, { padding: 50 });
